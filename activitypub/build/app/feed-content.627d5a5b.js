"use strict";(globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[]).push([[579],{713(e,t,a){a.r(t),a.d(t,{inspector:()=>F,stage:()=>H});var i=a(6087),r=a(1370),n=a(9445),s=a(3832),o=a(7143),d=a(3582);const c=["id","date","modified","title","excerpt","content","actor_info","status","link","ap_object_type","ap_tag"],l=[],p=[];var u=a(7723),g=a(6007),m=a(790);(0,u.__)("Avatar","activitypub");var v=a(8537),h=a(8107),y=a(2769);function b(e){return(0,v.decodeEntities)((0,h.__unstableStripHTML)(e.excerpt?.rendered||e.content?.rendered||""))}const f={id:"content",label:(0,u.__)("Content","activitypub"),enableHiding:!1,enableSorting:!1,getValue:({item:e})=>b(e),render:function({item:e}){const{getObjectTypeName:t,isLoading:a}=(0,y.t)(),i=e.ap_object_type?.[0],r=t(i);if(a&&!r)return(0,m.jsx)("div",{className:"activitypub-feed-excerpt",children:" "});if("Note"===r){const t=(0,h.safeHTML)((0,v.decodeEntities)(e.content?.rendered||""));return(0,m.jsx)("div",{className:"activitypub-feed-post",children:(0,m.jsx)("div",{className:"activitypub-feed-content",dangerouslySetInnerHTML:{__html:t||"<p> </p>"}})})}const n=b(e).trim();return(0,m.jsx)("div",{className:"activitypub-feed-excerpt",children:n||" "})}},_={id:"date",label:(0,u.__)("Date","activitypub"),enableHiding:!1,enableSorting:!0,getValue:({item:e})=>e.date||"",render:({item:e})=>e.date?new Date(e.date).toLocaleDateString():""};(0,u.__)("Following","activitypub");var x=a(8443);function j(e){const t=new Date(e.endsWith("Z")?e:e+"Z"),a=Date.now()-t.getTime(),i=Math.floor(a/6e4);if(i<60)return(0,u.sprintf)(/* translators: %d: number of minutes */ /* translators: %d: number of minutes */
(0,u._x)("%dm","short time format: minutes","activitypub"),i);const r=Math.floor(a/36e5);if(r<24)return(0,u.sprintf)(/* translators: %d: number of hours */ /* translators: %d: number of hours */
(0,u._x)("%dh","short time format: hours","activitypub"),r);const n=Math.floor(a/864e5);return n<7?(0,u.sprintf)(/* translators: %d: number of days */ /* translators: %d: number of days */
(0,u._x)("%dd","short time format: days","activitypub"),n):(0,x.dateI18n)((0,x.getSettings)().formats.date,e)}const w={id:"metadata",label:(0,u.__)("Metadata","activitypub"),enableHiding:!0,enableSorting:!1,getValue:({item:e})=>`${e.actor_info?.name||""} · ${e.date?j(e.date):""}`,render:({item:e})=>{const t=(0,v.decodeEntities)(e.actor_info?.name||(0,u.__)("Unknown author","activitypub")),a=e.date?j(e.date):"";return(0,m.jsxs)("div",{className:"activitypub-feed-post-meta",children:[(0,m.jsx)(g.A,{item:e}),(0,m.jsx)("span",{className:"author",children:t}),a&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("span",{className:"separator",children:"·"}),(0,m.jsx)("span",{className:"date",children:a})]})]})}};(0,u.__)("Last Updated","activitypub"),(0,u.__)("Name","activitypub");var N=a(9993);const S={id:"ap_object_type",type:"integer",label:(0,u.__)("Type","activitypub"),enableHiding:!1,enableSorting:!1,getValue:({item:e})=>e.ap_object_type?.[0],getElements:async()=>{const e=await(0,o.resolveSelect)(d.store).getEntityRecords("taxonomy","ap_object_type",{per_page:-1,orderby:"count",order:"desc",hide_empty:!0});return e?e.map(e=>({value:e.id,label:N.M[e.name]?.label||e.name})):[]},render:()=>null,filterBy:{operators:["is"]}},E=((0,u.__)("Status","activitypub"),{id:"ap_tag",type:"integer",label:(0,u.__)("Tag","activitypub"),enableHiding:!1,enableSorting:!1,getValue:({item:e})=>{var t;return null!==(t=e.ap_tag)&&void 0!==t?t:[]},getElements:async()=>{const e=await(0,o.resolveSelect)(d.store).getEntityRecords("taxonomy","ap_tag",{per_page:10,orderby:"count",order:"desc",hide_empty:!0});return e?e.map(e=>({value:e.id,label:`#${e.name}`})):[]},render:()=>null,filterBy:{operators:["isAny"]}}),C={id:"title.rendered",label:(0,u.__)("Title","activitypub"),enableHiding:!0,enableSorting:!1,enableGlobalSearch:!0,getValue:({item:e})=>(0,v.decodeEntities)(e.title?.rendered||""),render:({item:e})=>{if(!e.title?.rendered)return null;const t=e.title.rendered.replace(/\\(.)/g,"$1");return(0,m.jsx)("div",{className:"activitypub-feed-post-title",children:(0,v.decodeEntities)(t)})}};(0,u.__)("Profile","activitypub");var k=a(3953);function I(){const e=(0,o.useSelect)(e=>e(k.E).getActiveActorId(),[]),{view:t}=(0,n.useView)({kind:"postType",name:"ap_post",slug:"feed",defaultView:{type:"list",search:"",filters:[]}});if(t.search||t.filters&&t.filters.length>0)return(0,m.jsx)("p",{children:(0,u.__)("No posts found.","activitypub")});const a=0===e?(0,s.addQueryArgs)("options-general.php",{page:"activitypub",tab:"following"}):(0,s.addQueryArgs)("users.php",{page:"activitypub-following-list"});return(0,m.jsx)("p",{children:(0,i.createInterpolateElement)((0,u.__)("Your feed is waiting to come alive. <a>Follow more people on the Fediverse</a> to see their posts here.","activitypub"),{a:(0,m.jsx)("a",{href:a})})})}var T=a(9304);const A={type:"list",perPage:20,page:1,sort:{field:"date",direction:"desc"},search:"",filters:[],fields:["metadata","title.rendered","content"],infiniteScrollEnabled:!0},R={list:{primaryField:"metadata",fields:["metadata","title.rendered","content"],mediaField:void 0}};function H(){const e=(0,T.Zp)(),t=(0,i.useCallback)(t=>{e({search:e=>({...e,postId:t})})},[e]),a=(0,o.useSelect)(e=>e(k.E).getActiveActorId(),[]),[u,g]=(0,i.useState)(()=>{const e=(0,s.getQueryArgs)(window.location.href);return{page:e.paged?Number(e.paged):void 0,search:e.search||void 0}});(0,i.useEffect)(()=>{const e=()=>{const e=(0,s.getQueryArgs)(window.location.href);g({page:e.paged?Number(e.paged):void 0,search:e.search||void 0})};return window.addEventListener("popstate",e),window.addEventListener("hashchange",e),()=>{window.removeEventListener("popstate",e),window.removeEventListener("hashchange",e)}},[]);const v=(0,i.useCallback)(e=>{const t=window.location.href,a=(0,s.getQueryArgs)(t),i=(0,s.addQueryArgs)(t,{...a,paged:e.page||void 0,search:e.search||void 0});window.history.pushState(null,"",i),g({page:e.page,search:e.search})},[]),{view:h,updateView:y}=(0,n.useView)({kind:"postType",name:"ap_post",slug:"feed",defaultView:A,queryParams:u,onChangeQueryParams:v}),b=(0,i.useCallback)(e=>{var t;const a=JSON.stringify(h.filters)!==JSON.stringify(e.filters)?1:null!==(t=e.page)&&void 0!==t?t:1;y({...e,page:a})},[h.filters,y]),x=(0,i.useRef)(a);(0,i.useEffect)(()=>{x.current!==a&&(y({...A,fields:h.fields}),x.current=a)},[a]);const{feed:j,isResolving:N,totalItems:H,totalPages:L}=function({perPage:e=20,page:t=1,orderBy:a="date",order:r="desc",search:n="",userId:s,fields:o=c,filters:u=l}={}){const g=null!=s,m=(0,i.useMemo)(()=>{const i={per_page:e,page:t,orderby:a,order:r,search:n,_fields:o};g&&(i.user_id=s);const d=u.find(e=>"ap_object_type"===e.field);void 0!==d?.value&&(i.ap_object_type=Array.isArray(d.value)?d.value:[d.value]);const c=u.find(e=>"ap_tag"===e.field);return void 0!==c?.value&&(i.ap_tag=c.value),i},[e,t,a,r,n,s,o,g,u]),{records:v,hasResolved:h,isResolving:y,totalItems:b,totalPages:f}=(0,d.useEntityRecords)("postType","ap_post",m,{enabled:g});return{feed:g&&v||p,hasResolved:h,isResolving:y,totalItems:g?b:null,totalPages:g?f:null}}({perPage:h.perPage||20,page:h.page||1,orderBy:h.sort?.field||"date",order:h.sort?.direction||"desc",search:h.search||"",userId:a,filters:h.filters||A.filters}),M=(0,i.useMemo)(()=>[w,C,f,_,S,E],[]),V=(0,i.useMemo)(()=>function(e,t){if(!e.fields)return e;const a=new Map(t.map((e,t)=>[e.id,t])),i=[...e.fields].sort((e,t)=>{var i,r;return(null!==(i=a.get(e))&&void 0!==i?i:1/0)-(null!==(r=a.get(t))&&void 0!==r?r:1/0)});return{...e,fields:i}}(h,M),[h,M]),[P,F]=(0,i.useState)([]),[B,Q]=(0,i.useState)([]),[$,D]=(0,i.useState)(!1),Z=(0,i.useRef)(0),O=(0,i.useCallback)(e=>{F(e),0!==e.length&&t(Number(e[0]))},[t]),U=(0,i.useCallback)(()=>{const e=h.page||1;$||e>=(L||1)||(D(!0),b({...h,page:e+1}))},[$,h,L,b]);return(0,i.useEffect)(()=>{const e=V.page||1,t=V.infiniteScrollEnabled;if(0===j.length&&1===e)return Q([]),Z.current=e,void D(!1);0!==j.length&&(e>1&&Z.current===e||(1!==e&&t?(Q(e=>{const t=new Set(e.map(e=>e.id)),a=j.filter(e=>!t.has(e.id));return a.length>0?[...e,...a]:e}),Z.current=e,D(!1)):(Q(j),Z.current=e,D(!1))))},[j,V.page,V.search,V.infiniteScrollEnabled,V.filters]),(0,m.jsx)(r.Vw,{data:B,fields:M,view:V,onChangeView:b,isLoading:N||$,onClickItem:e=>t(e.id),isItemClickable:()=>!0,getItemId:e=>e.id.toString(),selection:P,onChangeSelection:O,empty:(0,m.jsx)(I,{}),paginationInfo:{totalItems:H,totalPages:L,infiniteScrollHandler:U},defaultLayouts:R})}var L=a(6427),M=a(2023),V=a(1958);const P=({html:e})=>{const t=e.replace(/\\(.)/g,"$1"),a=(0,v.decodeEntities)(t),i=(0,h.safeHTML)(a);return(0,m.jsx)("div",{dangerouslySetInnerHTML:{__html:i}})};function F(){const e=(0,T.SQ)({strict:!1}),t=(0,T.Zp)(),a=e.postId,i=()=>{t({search:e=>{const{postId:t,...a}=e;return a}})},{record:r,isResolving:n}=(0,d.useEntityRecord)("postType","ap_post",null!=a?a:0),{records:s,isResolving:o}=(0,d.useEntityRecords)("root","comment",{post:null!=a?a:0,order:"asc",orderby:"date"}),c=r?.ap_tag||[],{records:l}=(0,d.useEntityRecords)("taxonomy","ap_tag",{include:c}),{selectedTagId:p,updateTagFilter:h}=(0,V.K)();if(!a)return null;if(n)return(0,m.jsx)("div",{className:"activitypub-inspector-loading",children:(0,m.jsx)(L.Spinner,{})});if(!r)return(0,m.jsx)("div",{className:"activitypub-inspector-loading",children:(0,u.__)("Post not found","activitypub")});const y=r.actor_info,b=(0,v.decodeEntities)(y?.name||(0,u.__)("Unknown author","activitypub")),f=y?.webfinger||"",_=y?.url||"",x=r.link||"",w=r.date?j(r.date):"";return(0,m.jsxs)("div",{className:"activitypub-inspector",children:[(0,m.jsxs)(L.Card,{className:"activitypub-inspector-card",children:[(0,m.jsx)(L.CardHeader,{children:(0,m.jsxs)("div",{className:"activitypub-inspector-header",children:[(0,m.jsx)(g.A,{item:r}),(0,m.jsxs)("div",{className:"activitypub-inspector-author",children:[(0,m.jsx)("a",{href:_,target:"_blank",rel:"noopener noreferrer",className:"activitypub-inspector-author-name",children:b}),(0,m.jsxs)("div",{className:"activitypub-inspector-meta",children:[f&&(0,m.jsx)("span",{className:"activitypub-inspector-webfinger",children:f}),w&&x&&(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)("span",{className:"activitypub-inspector-separator",children:"·"}),(0,m.jsx)("a",{href:x,target:"_blank",rel:"noopener noreferrer",className:"activitypub-inspector-timestamp",children:w})]})]})]}),(0,m.jsx)(L.Button,{icon:M.A,label:(0,u.__)("Close","activitypub"),onClick:i,className:"activitypub-inspector-close"})]})}),(0,m.jsxs)(L.CardBody,{children:[r.title?.rendered&&(0,m.jsx)("h2",{children:(0,m.jsx)(P,{html:r.title.rendered})}),(r.content?.rendered||r.excerpt?.rendered)&&(0,m.jsx)(P,{html:r.content?.rendered||r.excerpt?.rendered||""}),l&&l.length>0&&(0,m.jsx)("div",{className:"activitypub-inspector-tags",children:l.map(e=>(0,m.jsxs)(L.Button,{size:"small",variant:"secondary",onClick:()=>{return t=e.id,void h(t,{onComplete:i});var t},"aria-pressed":p===e.id,"aria-label":/* translators: %s: tag name */ /* translators: %s: tag name */
(0,u.sprintf)((0,u.__)("Filter by tag: %s","activitypub"),e.name),children:["#",e.name]},e.id))})]})]}),(o||s&&s.length>0)&&(0,m.jsxs)(L.Card,{className:"activitypub-inspector-card activitypub-inspector-comments-card",children:[(0,m.jsxs)(L.CardHeader,{children:[(0,u.__)("Comments","activitypub"),s&&s.length>0&&` (${s.length})`]}),(0,m.jsxs)(L.CardBody,{children:[o&&(0,m.jsx)(L.Spinner,{}),!o&&s&&s.length>0&&(0,m.jsx)("div",{children:s.map(e=>{const t=e.date_gmt?j(e.date_gmt):"";return(0,m.jsxs)("div",{className:"activitypub-inspector-comment",children:[(0,m.jsxs)("div",{className:"activitypub-inspector-comment-meta",children:[(0,m.jsx)("strong",{children:(0,v.decodeEntities)(e.author_name)}),t&&(0,m.jsx)("span",{className:"activitypub-inspector-comment-date",children:t})]}),(0,m.jsx)(P,{html:e.content.rendered})]},e.id)})}),!o&&(!s||0===s.length)&&(0,m.jsx)("p",{children:(0,u.__)("No comments yet.","activitypub")})]})]})]})}}}]);