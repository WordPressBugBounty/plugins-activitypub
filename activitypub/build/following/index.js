(()=>{"use strict";var e,t={3659(e,t,i){const a=window.wp.blocks,n=window.wp.primitives,s=window.ReactJSXRuntime;var r=(0,s.jsx)(n.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,s.jsx)(n.Path,{d:"M15.5 9.5a1 1 0 100-2 1 1 0 000 2zm0 1.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zm-2.25 6v-2a2.75 2.75 0 00-2.75-2.75h-4A2.75 2.75 0 003.75 15v2h1.5v-2c0-.69.56-1.25 1.25-1.25h4c.69 0 1.25.56 1.25 1.25v2h1.5zm7-2v2h-1.5v-2c0-.69-.56-1.25-1.25-1.25H15v-1.5h2.5A2.75 2.75 0 0120.25 15zM9.5 8.5a1 1 0 11-2 0 1 1 0 012 0zm1.5 0a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z",fillRule:"evenodd"})});const o=window.wp.components,l=window.wp.blockEditor,c=window.wp.coreData,p=window.wp.data,u=window.wp.element,d=window.wp.i18n,h=window.wp.apiFetch;var v=i.n(h);function g(){return window._activityPubOptions||{}}function b({name:e}){const{enabled:t}=g(),i=t?.blog?"":(0,d.__)("It will be empty in other non-author contexts.","activitypub"),a=(0,d.sprintf)(/* translators: %1$s: block name, %2$s: extra information for non-author context */ /* translators: %1$s: block name, %2$s: extra information for non-author context */
(0,d.__)("This <strong>%1$s</strong> block will adapt to the page it is on, displaying the user profile associated with a post author (in a loop) or a user archive. %2$s","activitypub"),e,i).trim();return(0,s.jsx)(o.Card,{children:(0,s.jsx)(o.CardBody,{children:(0,u.createInterpolateElement)(a,{strong:(0,s.jsx)("strong",{})})})})}const y=window.wp.url;function w({name:e,icon:t,url:i,webfinger:a}){const n=`@${a}`,{defaultAvatarUrl:r,showAvatars:o}=g(),l=t?.url||r;return(0,s.jsxs)("a",{className:"activitypub-actor-link",href:i,title:n,onClick:e=>e.preventDefault(),children:[o&&(0,s.jsx)("img",{width:"48",height:"48",src:l,className:"activitypub-actor-avatar",alt:e,onError:e=>{e.target.src=r}}),(0,s.jsxs)("div",{className:"activitypub-actor-info",children:[(0,s.jsx)("span",{className:"activitypub-actor-name",children:e}),(0,s.jsx)("span",{className:"activitypub-actor-handle",children:n})]}),(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24",className:"external-link-icon","aria-hidden":"true",focusable:"false",fill:"currentColor",children:(0,s.jsx)("path",{d:"M18.2 17c0 .7-.6 1.2-1.2 1.2H7c-.7 0-1.2-.6-1.2-1.2V7c0-.7.6-1.2 1.2-1.2h3.2V4.2H7C5.5 4.2 4.2 5.5 4.2 7v10c0 1.5 1.2 2.8 2.8 2.8h10c1.5 0 2.8-1.2 2.8-2.8v-3.6h-1.5V17zM14.9 3v1.5h3.7l-6.4 6.4 1.1 1.1 6.4-6.4v3.7h1.5V3h-6.3z"})})]})}function f({page:e,pages:t,setPage:i,navLabel:a=(0,d.__)("Navigation","activitypub")}){if(t<=1)return null;const n=e<=1,r=e>=t;return(0,s.jsxs)("nav",{className:"activitypub-actor-list-pagination",role:"navigation",children:[(0,s.jsx)("h1",{className:"screen-reader-text",children:a}),(0,s.jsx)("a",{role:"button",tabIndex:0,className:"pagination-previous","aria-disabled":n,"aria-label":(0,d.__)("Previous page","activitypub"),onClick:()=>{n||i(e-1)},onKeyDown:t=>{n||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),i(e-1))},children:(0,d.__)("Previous","activitypub")}),(0,s.jsx)("div",{className:"pagination-info",children:`${e} / ${t}`}),(0,s.jsx)("a",{role:"button",tabIndex:0,className:"pagination-next","aria-disabled":r,"aria-label":(0,d.__)("Next page","activitypub"),onClick:()=>{r||i(e+1)},onKeyDown:t=>{r||"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),i(e+1))},children:(0,d.__)("Next","activitypub")})]})}function m({selectedUser:e,perPage:t,order:i,endpoint:a="followers",page:n,setPage:r,initialData:o=!1,emptyMessage:l=(0,d.__)("No results found.","activitypub"),navLabel:c=(0,d.__)("Navigation","activitypub")}){const{namespace:p}=g(),h="blog"===e?0:e,[b,m]=(0,u.useState)([]),[_,x]=(0,u.useState)(0),[j,k]=(0,u.useState)(1),N=n||j,S=r||k,U=(0,u.useCallback)((e,i)=>{m(e),x(Math.ceil(i/t))},[t]);return(0,u.useEffect)(()=>{if(o&&1===N)return U(o.items,o.total);const e=(0,y.addQueryArgs)(`/${p}/actors/${h}/${a}`,{per_page:t,order:i,page:N,context:"full"});v()({path:e}).then(({orderedItems:e=[],totalItems:t=0})=>U(e,t)).catch(()=>U([],0))},[p,h,t,i,N,a,o,U]),(0,s.jsxs)("div",{className:"activitypub-actor-list-container",children:[b.length?(0,s.jsx)("ul",{className:"activitypub-actor-list",children:b.map(e=>(0,s.jsx)("li",{className:"activitypub-actor-item",children:(0,s.jsx)(w,{...e})},e.url))}):(0,s.jsx)("p",{className:"activitypub-actor-list-placeholder",children:l}),(0,s.jsx)(f,{page:N,pages:_,setPage:S,navLabel:c})]})}function _(e){return!!e&&Object.entries(e).some(([e,t])=>e.endsWith("activitypub_hide_social_graph")&&t)}const x=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","name":"activitypub/following","apiVersion":3,"version":"7.8.4","title":"Fediverse Following","category":"widgets","description":"Display the accounts you follow in the Fediverse on your website.","textdomain":"activitypub","icon":"groups","supports":{"html":false,"interactivity":true},"attributes":{"selectedUser":{"type":"string","default":"blog"},"per_page":{"type":"number","default":10},"order":{"type":"string","default":"desc","enum":["asc","desc"]}},"usesContext":["postType","postId"],"styles":[{"name":"default","label":"Default","isDefault":true},{"name":"card","label":"Card"},{"name":"compact","label":"Compact"}],"editorScript":"file:./index.js","editorStyle":"file:./index.css","viewScriptModule":"file:./view.js","viewScript":"wp-api-fetch","style":["file:./style-index.css"],"render":"file:./render.php"}');(0,a.registerBlockType)(x,{edit:function({attributes:e,setAttributes:t,context:{postType:i,postId:a}}){const{className:n="",order:r,per_page:h,selectedUser:y}=e,w=(0,l.useBlockProps)(),[f,x]=(0,u.useState)(1),j=[{label:(0,d.__)("New to old","activitypub"),value:"desc"},{label:(0,d.__)("Old to new","activitypub"),value:"asc"}],k=function({withInherit:e=!1}){const{enabled:t,namespace:i}=g(),[a,n]=(0,u.useState)(!1),{fetchedUsers:s,isLoadingUsers:r}=(0,p.useSelect)(e=>{const{getUsers:i,getIsResolving:a}=e("core");return{fetchedUsers:t?.users?i({capabilities:"activitypub"}):null,isLoadingUsers:!!t?.users&&a("getUsers",[{capabilities:"activitypub"}])}},[t?.users]),o=(0,p.useSelect)(e=>s||r?null:e("core").getCurrentUser(),[s,r]);(0,u.useEffect)(()=>{s||r||!o||v()({path:`/${i}/actors/${o.id}`,method:"HEAD",headers:{Accept:"application/activity+json"},parse:!1}).then(()=>n(!0)).catch(()=>n(!1))},[s,r,o,i]);const l=(0,u.useMemo)(()=>s||(o&&a?[{id:o.id,name:o.name}]:[]),[s,o,a]);return(0,u.useMemo)(()=>{if(!l.length)return[];const i=[];return t?.blog&&s&&i.push({label:(0,d.__)("Blog","activitypub"),value:"blog"}),e&&t?.users&&s&&i.push({label:(0,d.__)("Dynamic User","activitypub"),value:"inherit"}),l.reduce((e,t)=>(e.push({label:t.name,value:`${t.id}`}),e),i)},[l,t?.blog,t?.users,s,e])}({withInherit:!0}),N=e=>i=>{x(1),t({[e]:i})},{blogSocialGraphHidden:S,currentUser:U,usersWithMeta:C,siteUrl:M,canManageOptions:O}=(0,p.useSelect)(e=>{const{getCurrentUser:t,getUsers:i,getEntityRecord:a,canUser:n}=e(c.store),s=a("root","site"),r=a("root","__unstableBase");return{blogSocialGraphHidden:!!s?.activitypub_hide_social_graph,currentUser:t(),usersWithMeta:i({capabilities:"activitypub",context:"edit"}),siteUrl:r?.home,canManageOptions:n("update",{kind:"root",name:"site"})}},[]),P=(0,p.useSelect)(e=>{const{getEditedEntityRecord:t}=e(c.store),n=t("postType",i,a)?.author;return null!=n?n:null},[i,a]),D=(0,u.useMemo)(()=>k.length&&C?k.filter(({value:e})=>{if("inherit"===e)return!0;if("blog"===e)return!S;const t=C?.find(t=>String(t.id)===e);return!_(t?.meta)}):[],[k,S,C]),E=(0,u.useMemo)(()=>{if(!C)return!1;if("blog"===y)return S;if("inherit"===y){if(!P)return!1;const e=C.find(e=>e.id===P);return!!e&&_(e.meta)}return!1},[y,P,C,S]),I=(0,u.useMemo)(()=>!(!E||!U)&&("blog"===y?O:U.id===P),[E,U,y,P,O]),F=(0,u.useMemo)(()=>I&&M?"blog"===y?M+"/wp-admin/options-general.php?page=activitypub&tab=blog-profile":M+"/wp-admin/profile.php#activitypub":null,[I,M,y]);(0,u.useEffect)(()=>{D.length&&("blog"===y||"inherit"===y||D.find(({value:e})=>e===y)||t({selectedUser:D[0].value}))},[y,D,t]);const $=[["core/heading",{level:3,placeholder:(0,d.__)("Fediverse Following","activitypub"),content:(0,d.__)("Fediverse Following","activitypub")}]];return(0,s.jsxs)("div",{...w,children:[(0,s.jsx)(l.InspectorControls,{children:(0,s.jsxs)(o.PanelBody,{title:(0,d.__)("Following Options","activitypub"),children:[D.length>1&&(0,s.jsx)(o.SelectControl,{label:(0,d.__)("Select User","activitypub"),value:y,options:D,onChange:N("selectedUser"),__next40pxDefaultSize:!0}),(0,s.jsx)(o.SelectControl,{label:(0,d.__)("Sort","activitypub"),value:r,options:j,onChange:N("order"),__next40pxDefaultSize:!0}),(0,s.jsx)(o.RangeControl,{label:(0,d.__)("Number of Following","activitypub"),value:h,onChange:N("per_page"),min:1,max:10,__next40pxDefaultSize:!0})]})},"setting"),(0,s.jsxs)("div",{className:`wp-block-activitypub-following ${n}`,children:[(0,s.jsx)(l.InnerBlocks,{template:$,allowedBlocks:["core/heading"],templateLock:"all",renderAppender:!1}),E&&(0,s.jsx)(o.Notice,{status:"warning",isDismissible:!1,children:F?(0,u.createInterpolateElement)(/* translators: <a> is a link to the profile settings page. */ /* translators: <a> is a link to the profile settings page. */
(0,d.__)("The selected user has their social graph hidden. This block will not display following on the frontend. <a>Edit privacy settings</a>","activitypub"),{a:(0,s.jsx)(o.ExternalLink,{href:F})}):(0,d.__)("The selected user has their social graph hidden. This block will not display following on the frontend.","activitypub")}),!E&&"inherit"===y&&P&&(0,s.jsx)(m,{selectedUser:P,perPage:h,order:r,endpoint:"following",page:f,setPage:x,emptyMessage:(0,d.__)("Not following anyone yet.","activitypub"),navLabel:(0,d.__)("Following navigation","activitypub")}),!E&&"inherit"===y&&!P&&(0,s.jsx)(b,{name:(0,d.__)("Following","activitypub")}),!E&&"inherit"!==y&&(0,s.jsx)(m,{selectedUser:y,perPage:h,order:r,endpoint:"following",page:f,setPage:x,emptyMessage:(0,d.__)("Not following anyone yet.","activitypub"),navLabel:(0,d.__)("Following navigation","activitypub")})]})]})},save:function(){const e=l.useBlockProps.save(),t=l.useInnerBlocksProps.save(e);return(0,s.jsx)("div",{...t})},icon:r})}},i={};function a(e){var n=i[e];if(void 0!==n)return n.exports;var s=i[e]={exports:{}};return t[e](s,s.exports,a),s.exports}a.m=t,e=[],a.O=(t,i,n,s)=>{if(!i){var r=1/0;for(p=0;p<e.length;p++){for(var[i,n,s]=e[p],o=!0,l=0;l<i.length;l++)(!1&s||r>=s)&&Object.keys(a.O).every(e=>a.O[e](i[l]))?i.splice(l--,1):(o=!1,s<r&&(r=s));if(o){e.splice(p--,1);var c=n();void 0!==c&&(t=c)}}return t}s=s||0;for(var p=e.length;p>0&&e[p-1][2]>s;p--)e[p]=e[p-1];e[p]=[i,n,s]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var i in t)a.o(t,i)&&!a.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={801:0,509:0};a.O.j=t=>0===e[t];var t=(t,i)=>{var n,s,[r,o,l]=i,c=0;if(r.some(t=>0!==e[t])){for(n in o)a.o(o,n)&&(a.m[n]=o[n]);if(l)var p=l(a)}for(t&&t(i);c<r.length;c++)s=r[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(p)},i=globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})();var n=a.O(void 0,[509],()=>a(3659));n=a.O(n)})();