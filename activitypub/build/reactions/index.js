(()=>{"use strict";var e,t={2091(e,t,r){const s=window.wp.blocks,a=window.wp.blockEditor,i=window.ReactJSXRuntime,l=[{attributes:{},supports:{html:!1,align:!0,layout:{default:{type:"constrained",orientation:"vertical",justifyContent:"center"}}},save:()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a.InnerBlocks.Content,{}),(0,i.jsx)("div",{className:"activitypub-reactions-block"})]})},{attributes:{title:{type:"string",default:"Fediverse reactions"}},supports:{html:!1,align:!0,layout:{default:{type:"constrained",orientation:"vertical",justifyContent:"center"}}},save:()=>null,isEligible:({title:e})=>!!e,migrate:({title:e,...t})=>[t,[(0,s.createBlock)("core/heading",{content:e,level:6})]]}];function n(e){var t,r,s="";if("string"==typeof e||"number"==typeof e)s+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(r=n(e[t]))&&(s&&(s+=" "),s+=r)}else for(r in e)e[r]&&(s&&(s+=" "),s+=r);return s}const o=function(){for(var e,t,r=0,s="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=n(e))&&(s&&(s+=" "),s+=t);return s},c=window.wp.i18n,u=window.wp.data,p=window.wp.element,d=window.wp.components,f=window.wp.apiFetch;var m=r.n(f);function y(){return window._activityPubOptions||{}}const v=({reactions:e,displayStyle:t})=>{const{defaultAvatarUrl:r}=y();return"compact"===t?null:(0,i.jsx)("ul",{className:"reaction-avatars",children:e.map((e,t)=>{const s=["reaction-avatar"].filter(Boolean).join(" "),a=e.avatar||r;return(0,i.jsx)("li",{children:(0,i.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:(0,i.jsx)("img",{src:a,alt:e.name,className:s,width:"32",height:"32",onError:e=>{e.target.src=r}})})},t)})})},h=({reactions:e,displayStyle:t})=>{const{defaultAvatarUrl:r}=y();return(0,i.jsx)("ul",{className:"reactions-list",children:e.map((e,s)=>{const a=e.avatar||r;return(0,i.jsx)("li",{className:"reaction-item",children:(0,i.jsxs)("a",{href:e.url,className:"reaction-item",target:"_blank",rel:"noopener noreferrer",children:["facepile"===t&&(0,i.jsx)("img",{src:a,alt:e.name,width:"32",height:"32",onError:e=>{e.target.src=r}}),(0,i.jsx)("span",{className:"reaction-name",children:e.name})]})},s)})})},b=({items:e,label:t,displayStyle:r})=>{const[s,a]=(0,p.useState)(!1),[l,n]=(0,p.useState)(null),o=(0,p.useRef)(null),c=e.slice(0,20);return(0,i.jsxs)("div",{className:"reaction-group",ref:o,children:[(0,i.jsx)(v,{reactions:c,displayStyle:r}),(0,i.jsx)(d.Button,{ref:n,className:"reaction-label is-link",onClick:()=>a(!s),"aria-expanded":s,children:t}),s&&l&&(0,i.jsx)(d.Popover,{anchor:l,onClose:()=>a(!1),className:"activitypub-popover",children:(0,i.jsx)(h,{reactions:e,displayStyle:r})})]})};function g({postId:e=null,reactions:t=null,fallbackReactions:r=null,displayStyle:s="facepile"}){const{namespace:a}=y(),[l,n]=(0,p.useState)(t),[o,c]=(0,p.useState)(!t),u=(0,p.useCallback)(()=>{r&&n(r),c(!1)},[r]);return(0,p.useEffect)(()=>{if(t)return n(t),void c(!1);e&&"number"==typeof e?(c(!0),m()({path:`/${a}/posts/${e}/reactions`}).then(e=>{const t=Object.values(e).some(e=>e.items?.length>0);n(!t&&r?r:e),c(!1)}).catch(u)):u()},[e,t,r,a,u]),o?null:l&&Object.values(l).some(e=>e.items?.length>0)?(0,i.jsx)("div",{className:"activitypub-reactions",children:Object.entries(l).map(([e,t])=>t.items?.length?(0,i.jsx)(b,{items:t.items,label:t.label,displayStyle:s},e):null)}):null}const w=(e,t,r,s)=>Array.from({length:e},(e,a)=>({name:`${t} ${a+1}`,url:"#",avatar:`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%23${s[a%s.length]}'/%3E%3Ctext x='32' y='38' font-family='sans-serif' font-size='24' fill='white' text-anchor='middle'%3E${String.fromCharCode(r+a)}%3C/text%3E%3C/svg%3E`})),x=["FF6B6B","4ECDC4","45B7D1","96CEB4","D4A5A5","9B59B6","3498DB","E67E22"],j={likes:{label:(0,c.sprintf)(/* translators: %d: Number of likes */ /* translators: %d: Number of likes */
(0,c._x)("%d likes","number of likes","activitypub"),9),items:w(9,"User",65,x)},reposts:{label:(0,c.sprintf)(/* translators: %d: Number of reposts */ /* translators: %d: Number of reposts */
(0,c._x)("%d reposts","number of reposts","activitypub"),6),items:w(6,"Reposter",82,x)},quotes:{label:(0,c.sprintf)(/* translators: %d: Number of quotes */ /* translators: %d: Number of quotes */
(0,c._x)("%d quotes","number of quotes","activitypub"),7),items:w(7,"Quoter",81,x)}},k=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","name":"activitypub/reactions","apiVersion":3,"version":"7.8.4","title":"Fediverse Reactions","category":"widgets","icon":"heart","description":"Display Fediverse likes and reposts","example":{"attributes":{"className":"is-style-facepile"}},"styles":[{"name":"facepile","label":"Facepile","isDefault":true},{"name":"compact","label":"Compact"}],"attributes":{"displayStyle":{"type":"string","default":"facepile"}},"supports":{"align":["wide","full"],"color":{"gradients":true},"__experimentalBorder":{"radius":true,"width":true,"color":true,"style":true},"html":false,"interactivity":true,"layout":{"default":{"type":"constrained","orientation":"vertical","justifyContent":"center"},"allowEditing":false},"shadow":true,"typography":{"fontSize":true,"__experimentalDefaultControls":{"fontSize":true}}},"blockHooks":{"core/post-content":"after"},"textdomain":"activitypub","editorScript":"file:./index.js","style":"file:./style-index.css","viewScriptModule":"file:./view.js","viewScript":"wp-api-fetch","render":"file:./render.php"}');(0,s.registerBlockType)(k,{deprecated:l,edit:function({attributes:e,setAttributes:t,__unstableLayoutClassNames:r}){const{className:s="",displayStyle:l="facepile"}=e,n=(0,a.useBlockProps)({className:r}),{getCurrentPostId:d}=(0,u.select)("core/editor"),{showAvatars:f=!0}=y(),m=(0,p.useRef)(!1);(0,p.useEffect)(()=>{if(m.current)return;m.current=!0;const e=s?.includes("is-style-");if(!e){const e=f?"facepile":"compact";t({className:o(s,`is-style-${e}`),displayStyle:e})}},[s,f,t]);const v=s?.includes("is-style-compact")?"compact":"facepile";(0,p.useEffect)(()=>{v!==l&&t({displayStyle:v})},[v,l,t]);const h=[["core/heading",{level:6,placeholder:(0,c.__)("Fediverse Reactions","activitypub"),content:(0,c.__)("Fediverse Reactions","activitypub")}]];return(0,i.jsxs)("div",{...n,children:[(0,i.jsx)(a.InnerBlocks,{template:h,allowedBlocks:["core/heading"],templateLock:"all",renderAppender:!1}),(0,i.jsx)(g,{postId:d(),fallbackReactions:j,displayStyle:l})]})},save:function(){return(0,i.jsx)("div",{...a.useBlockProps.save(),children:(0,i.jsx)(a.InnerBlocks.Content,{})})}})}},r={};function s(e){var a=r[e];if(void 0!==a)return a.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,s),i.exports}s.m=t,e=[],s.O=(t,r,a,i)=>{if(!r){var l=1/0;for(u=0;u<e.length;u++){for(var[r,a,i]=e[u],n=!0,o=0;o<r.length;o++)(!1&i||l>=i)&&Object.keys(s.O).every(e=>s.O[e](r[o]))?r.splice(o--,1):(n=!1,i<l&&(l=i));if(n){e.splice(u--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[r,a,i]},s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={608:0,104:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var a,i,[l,n,o]=r,c=0;if(l.some(t=>0!==e[t])){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(o)var u=o(s)}for(t&&t(r);c<l.length;c++)i=l[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(u)},r=globalThis.webpackChunkwordpress_activitypub=globalThis.webpackChunkwordpress_activitypub||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var a=s.O(void 0,[104],()=>s(2091));a=s.O(a)})();