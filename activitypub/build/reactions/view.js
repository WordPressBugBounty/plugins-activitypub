(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.element,r=window.wp.domReady;var a=e.n(r);const c=window.wp.components,o=window.wp.apiFetch;var s=e.n(o);function l(){return window._activityPubOptions||{}}window.wp.i18n;const i=({reactions:e})=>{const{defaultAvatarUrl:r}=l(),[a,c]=(0,n.useState)(new Set),[o,s]=(0,n.useState)(new Map),i=(0,n.useRef)([]),u=()=>{i.current.forEach((e=>clearTimeout(e))),i.current=[]},m=(t,n)=>{u();const r=100,a=e.length;n&&s((e=>{const n=new Map(e);return n.set(t,"clockwise"),n}));const o=e=>{const o="right"===e,l=o?a-1:0,u=o?1:-1;for(let e=o?t:t-1;o?e<=l:e>=l;e+=u){const a=Math.abs(e-t),o=setTimeout((()=>{c((t=>{const r=new Set(t);return n?r.add(e):r.delete(e),r})),n&&e!==t&&s((t=>{const n=new Map(t),r=e-u,a=n.get(r);return n.set(e,"clockwise"===a?"counter":"clockwise"),n}))}),a*r);i.current.push(o)}};if(o("right"),o("left"),!n){const e=Math.max((a-t)*r,t*r),n=setTimeout((()=>{s(new Map)}),e+r);i.current.push(n)}};return(0,n.useEffect)((()=>()=>u()),[]),(0,t.createElement)("ul",{className:"reaction-avatars"},e.map(((e,n)=>{const c=o.get(n),s=["reaction-avatar",a.has(n)?"wave-active":"",c?`rotate-${c}`:""].filter(Boolean).join(" "),l=e.avatar||r;return(0,t.createElement)("li",{key:n},(0,t.createElement)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onMouseEnter:()=>m(n,!0),onMouseLeave:()=>m(n,!1)},(0,t.createElement)("img",{src:l,alt:e.name,className:s,width:"32",height:"32",onError:e=>{e.target.src=r}})))})))},u=({reactions:e,type:n})=>(0,t.createElement)("ul",{className:"activitypub-reaction-list"},e.map(((e,n)=>(0,t.createElement)("li",{key:n},(0,t.createElement)("a",{href:e.url,className:"reaction-item",target:"_blank",rel:"noopener noreferrer"},(0,t.createElement)("img",{src:e.avatar,alt:e.name,width:"32",height:"32"}),(0,t.createElement)("span",null,e.name)))))),m=({items:e,label:r})=>{const[a,o]=(0,n.useState)(!1),[s,l]=(0,n.useState)(null),[m,p]=(0,n.useState)(e.length),f=(0,n.useRef)(null);(0,n.useEffect)((()=>{if(!f.current)return;const t=()=>{const t=f.current;if(!t)return;const n=t.offsetWidth-(s?.offsetWidth||0)-12,r=Math.max(1,Math.floor((n-32)/22));p(Math.min(r,e.length))};t();const n=new ResizeObserver(t);return n.observe(f.current),()=>{n.disconnect()}}),[s,e.length]);const h=e.slice(0,m);return(0,t.createElement)("div",{className:"reaction-group",ref:f},(0,t.createElement)(i,{reactions:h}),(0,t.createElement)(c.Button,{ref:l,className:"reaction-label is-link",onClick:()=>o(!a),"aria-expanded":a},r),a&&s&&(0,t.createElement)(c.Popover,{anchor:s,onClose:()=>o(!1)},(0,t.createElement)(u,{reactions:e})))};function p({postId:e=null,reactions:r=null}){const{namespace:a}=l(),[c,o]=(0,n.useState)(r),[i,u]=(0,n.useState)(!r);return(0,n.useEffect)((()=>{if(r)return o(r),void u(!1);e?(u(!0),s()({path:`/${a}/posts/${e}/reactions`}).then((e=>{o(e),u(!1)})).catch((()=>u(!1)))):u(!1)}),[e,r]),i?null:c&&Object.values(c).some((e=>e.items?.length>0))?(0,t.createElement)(t.Fragment,null,Object.entries(c).map((([e,n])=>n.items?.length?(0,t.createElement)(m,{key:e,items:n.items,label:n.label}):null))):null}a()((()=>{[].forEach.call(document.querySelectorAll(".activitypub-reactions-block"),(e=>{const r=JSON.parse(e.dataset.attrs||e.parentElement.dataset.attrs);(0,n.createRoot)(e).render((0,t.createElement)(p,{...r}))}))}))})();