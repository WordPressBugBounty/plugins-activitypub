(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,n=window.wp.element,a=window.wp.domReady;var r=e.n(a);const c=window.wp.blockEditor,o=window.wp.components,s=window.wp.apiFetch;var l=e.n(s);const i=window.wp.i18n,{namespace:u}=window._activityPubOptions,m=({reactions:e})=>{const[a,r]=(0,n.useState)(new Set),[c,o]=(0,n.useState)(new Map),s=(0,n.useRef)([]),l=()=>{s.current.forEach((e=>clearTimeout(e))),s.current=[]},i=(t,n)=>{l();const a=100,c=e.length;n&&o((e=>{const n=new Map(e);return n.set(t,"clockwise"),n}));const i=e=>{const l="right"===e,i=l?c-1:0,u=l?1:-1;for(let e=l?t:t-1;l?e<=i:e>=i;e+=u){const c=Math.abs(e-t),l=setTimeout((()=>{r((t=>{const a=new Set(t);return n?a.add(e):a.delete(e),a})),n&&e!==t&&o((t=>{const n=new Map(t),a=e-u,r=n.get(a);return n.set(e,"clockwise"===r?"counter":"clockwise"),n}))}),c*a);s.current.push(l)}};if(i("right"),i("left"),!n){const e=Math.max((c-t)*a,t*a),n=setTimeout((()=>{o(new Map)}),e+a);s.current.push(n)}};return(0,n.useEffect)((()=>()=>l()),[]),(0,t.createElement)("ul",{className:"reaction-avatars"},e.map(((e,n)=>{const r=c.get(n),o=["reaction-avatar",a.has(n)?"wave-active":"",r?`rotate-${r}`:""].filter(Boolean).join(" ");return(0,t.createElement)("li",{key:n},(0,t.createElement)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",onMouseEnter:()=>i(n,!0),onMouseLeave:()=>i(n,!1)},(0,t.createElement)("img",{src:e.avatar,alt:e.name,className:o,width:"32",height:"32"})))})))},h=({reactions:e,type:n})=>(0,t.createElement)("ul",{className:"reaction-list"},e.map(((e,n)=>(0,t.createElement)("li",{key:n},(0,t.createElement)("a",{href:e.url,className:"reaction-item",target:"_blank",rel:"noopener noreferrer"},(0,t.createElement)("img",{src:e.avatar,alt:e.name,width:"32",height:"32"}),(0,t.createElement)("span",null,e.name)))))),d=({items:e,label:a})=>{const[r,c]=(0,n.useState)(!1),[s,l]=(0,n.useState)(null),[i,u]=(0,n.useState)(e.length),d=(0,n.useRef)(null);(0,n.useEffect)((()=>{if(!d.current)return;const t=()=>{const t=d.current;if(!t)return;const n=t.offsetWidth-(s?.offsetWidth||0)-12,a=Math.max(1,Math.floor((n-32)/22));u(Math.min(a,e.length))};t();const n=new ResizeObserver(t);return n.observe(d.current),()=>{n.disconnect()}}),[s,e.length]);const p=e.slice(0,i);return(0,t.createElement)("div",{className:"reaction-group",ref:d},(0,t.createElement)(m,{reactions:p}),(0,t.createElement)(o.Button,{ref:l,className:"reaction-label is-link",onClick:()=>c(!r),"aria-expanded":r},a),r&&s&&(0,t.createElement)(o.Popover,{anchor:s,onClose:()=>c(!1)},(0,t.createElement)(h,{reactions:e})))};function p({title:e="",postId:a=null,isEditing:r=!1,setTitle:o=(()=>{}),reactions:s=null}){const[m,h]=(0,n.useState)(s),[p,w]=(0,n.useState)(!s);return(0,n.useEffect)((()=>{if(s)return h(s),void w(!1);a?(w(!0),l()({path:`/${u}/posts/${a}/reactions`}).then((e=>{h(e),w(!1)})).catch((()=>w(!1)))):w(!1)}),[a,s]),p?null:m&&Object.values(m).some((e=>e.items?.length>0))?(0,t.createElement)("div",{className:"activitypub-reactions"},r?(0,t.createElement)(c.RichText,{tagName:"h6",value:e,onChange:o,placeholder:(0,i.__)("Fediverse reactions","activitypub"),disableLineBreaks:!0,allowedFormats:[]}):e&&(0,t.createElement)("h6",null,e),Object.entries(m).map((([e,n])=>n.items?.length?(0,t.createElement)(d,{key:e,items:n.items,label:n.label}):null))):null}r()((()=>{[].forEach.call(document.querySelectorAll(".activitypub-reactions-block"),(e=>{const a=JSON.parse(e.dataset.attrs);(0,n.createRoot)(e).render((0,t.createElement)(p,{...a}))}))}))})();